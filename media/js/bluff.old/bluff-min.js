Bluff={VERSION:'0.3.4',array:function(a){if(a.length===undefined)return[a];var b=[],i=a.length;while(i--)b[i]=a[i];return b},each:function(a,b,c){for(var i=0,n=a.length;i<n;i++){b.call(c||null,a[i],i)}},reverse_each:function(a,b,c){var i=a.length;while(i--)b.call(c||null,a[i],i)},sum:function(a){var b=0,i=a.length;while(i--)b+=a[i];return b},Mini:{}};Bluff.Base=new JS.Class({extend:{DEBUG:false,DATA_LABEL_INDEX:0,DATA_VALUES_INDEX:1,DATA_COLOR_INDEX:2,LEGEND_MARGIN:10,TITLE_MARGIN:10,LABEL_MARGIN:10,DEFAULT_TARGET_WIDTH:800},top_margin:null,bottom_margin:null,right_margin:null,left_margin:null,labels:null,center_labels_over_point:null,has_left_labels:null,x_axis_label:null,y_axis_label:null,y_axis_increment:null,colors:null,title:null,font:null,font_color:null,hide_line_markers:null,hide_legend:null,hide_title:null,hide_line_numbers:null,no_data_message:null,title_font_size:null,legend_font_size:null,marker_font_size:null,marker_color:null,marker_count:null,minimum_value:null,maximum_value:null,sort:null,additional_line_values:null,stacked:null,legend_box_size:null,initialize:function(a,b){this._d=new Bluff.Renderer(a);b=b||this.klass.DEFAULT_TARGET_WIDTH;this.top_margin=this.bottom_margin=this.left_margin=this.right_margin=20;var c;if(typeof b!='number'){c=b.split('x');this._columns=parseFloat(c[0]);this._rows=parseFloat(c[1])}else{this._columns=parseFloat(b);this._rows=this._columns*0.75}this.initialize_ivars();this._reset_themes();this.theme_keynote()},initialize_ivars:function(){this._raw_columns=800;this._raw_rows=800*(this._rows/this._columns);this._column_count=0;this.marker_count=null;this.maximum_value=this.minimum_value=null;this._has_data=false;this._data=[];this.labels={};this._labels_seen={};this.sort=true;this.title=null;this._scale=this._columns/this._raw_columns;this.marker_font_size=21.0;this.legend_font_size=20.0;this.title_font_size=36.0;this.legend_box_size=20.0;this.no_data_message="No Data";this.hide_line_markers=this.hide_legend=this.hide_title=this.hide_line_numbers=false;this.center_labels_over_point=true;this.has_left_labels=false;this.additional_line_values=[];this._additional_line_colors=[];this._theme_options={};this.x_axis_label=this.y_axis_label=null;this.y_axis_increment=null;this.stacked=null;this._norm_data=null},set_margins:function(a){this.top_margin=this.left_margin=this.right_margin=this.bottom_margin=a},set_font:function(a){this.font=a;this._d.font=this.font},add_color:function(a){this.colors.push(a)},replace_colors:function(a){this.colors=a||[]},set_theme:function(a){this._reset_themes();this._theme_options={colors:['black','white'],additional_line_colors:[],marker_color:'white',font_color:'black',background_colors:null,background_image:null};for(var b in a)this._theme_options[b]=a[b];this.colors=this._theme_options.colors;this.marker_color=this._theme_options.marker_color;this.font_color=this._theme_options.font_color||this.marker_color;this._additional_line_colors=this._theme_options.additional_line_colors;this._render_background()},theme_keynote:function(){this._blue='#6886B4';this._yellow='#FDD84E';this._green='#72AE6E';this._red='#D1695E';this._purple='#8A6EAF';this._orange='#EFAA43';this._white='white';this.colors=[this._yellow,this._blue,this._green,this._red,this._purple,this._orange,this._white];this.set_theme({colors:this.colors,marker_color:'white',font_color:'white',background_colors:['black','#4a465a']})},theme_37signals:function(){this._green='#339933';this._purple='#cc99cc';this._blue='#336699';this._yellow='#FFF804';this._red='#ff0000';this._orange='#cf5910';this._black='black';this.colors=[this._yellow,this._blue,this._green,this._red,this._purple,this._orange,this._black];this.set_theme({colors:this.colors,marker_color:'black',font_color:'black',background_colors:['#d1edf5','white']})},theme_rails_keynote:function(){this._green='#00ff00';this._grey='#333333';this._orange='#ff5d00';this._red='#f61100';this._white='white';this._light_grey='#999999';this._black='black';this.colors=[this._green,this._grey,this._orange,this._red,this._white,this._light_grey,this._black];this.set_theme({colors:this.colors,marker_color:'white',font_color:'white',background_colors:['#0083a3','#0083a3']})},theme_odeo:function(){this._grey='#202020';this._white='white';this._dark_pink='#a21764';this._green='#8ab438';this._light_grey='#999999';this._dark_blue='#3a5b87';this._black='black';this.colors=[this._grey,this._white,this._dark_blue,this._dark_pink,this._green,this._light_grey,this._black];this.set_theme({colors:this.colors,marker_color:'white',font_color:'white',background_colors:['#ff47a4','#ff1f81']})},theme_pastel:function(){this.colors=['#a9dada','#aedaa9','#daaea9','#dadaa9','#a9a9da','#daaeda','#dadada'];this.set_theme({colors:this.colors,marker_color:'#aea9a9',font_color:'black',background_colors:'white'})},theme_greyscale:function(){this.colors=['#282828','#383838','#686868','#989898','#c8c8c8','#e8e8e8'];this.set_theme({colors:this.colors,marker_color:'#aea9a9',font_color:'black',background_colors:'white'})},data:function(c,d,e){d=(d===undefined)?[]:d;e=e||null;d=Bluff.array(d);this._data.push([c,d,(e||this._increment_color())]);this._column_count=(d.length>this._column_count)?d.length:this._column_count;Bluff.each(d,function(a,b){if(a===undefined)return;if(this.maximum_value===null&&this.minimum_value===null)this.maximum_value=this.minimum_value=a;this.maximum_value=this._larger_than_max(a)?a:this.maximum_value;if(this.maximum_value>=0)this._has_data=true;this.minimum_value=this._less_than_min(a)?a:this.minimum_value;if(this.minimum_value<0)this._has_data=true},this)},draw:function(){if(this.stacked)this._make_stacked();this._setup_drawing();this._debug(function(){this._d.rectangle(this.left_margin,this.top_margin,this._raw_columns-this.right_margin,this._raw_rows-this.bottom_margin);this._d.rectangle(this._graph_left,this._graph_top,this._graph_right,this._graph_bottom)})},clear:function(){this._render_background()},_setup_drawing:function(){if(!this._has_data)return this._draw_no_data();this._normalize();this._setup_graph_measurements();if(this.sort)this._sort_norm_data();this._draw_legend();this._draw_line_markers();this._draw_axis_labels();this._draw_title()},_normalize:function(d){if(this._norm_data===null||d===true){this._norm_data=[];if(!this._has_data)return;this._calculate_spread();Bluff.each(this._data,function(b){var c=[];Bluff.each(b[this.klass.DATA_VALUES_INDEX],function(a){if(a===null||a===undefined)c.push(null);else c.push((a-this.minimum_value)/this._spread)},this);this._norm_data.push([b[this.klass.DATA_LABEL_INDEX],c,b[this.klass.DATA_COLOR_INDEX]])},this)}},_calculate_spread:function(){this._spread=this.maximum_value-this.minimum_value;this._spread=this._spread>0?this._spread:1;this._significant_digits=100/Math.pow(10,Math.round(Math.LOG10E*Math.log(this._spread)))},_setup_graph_measurements:function(){this._marker_caps_height=this.hide_line_markers?0:this._calculate_caps_height(this.marker_font_size);this._title_caps_height=this.hide_title?0:this._calculate_caps_height(this.title_font_size);this._legend_caps_height=this.hide_legend?0:this._calculate_caps_height(this.legend_font_size);var a,longest_left_label_width,line_number_width,last_label,extra_room_for_long_label,x_axis_label_height,key;if(this.hide_line_markers){this._graph_left=this.left_margin;this._graph_right_margin=this.right_margin;this._graph_bottom_margin=this.bottom_margin}else{longest_left_label_width=0;if(this.has_left_labels){a='';for(key in this.labels){a=a.length>this.labels[key].length?a:this.labels[key]}longest_left_label_width=this._calculate_width(this.marker_font_size,a)*1.25}else{longest_left_label_width=this._calculate_width(this.marker_font_size,this._label(this.maximum_value))}line_number_width=this.hide_line_numbers&&!this.has_left_labels?0:longest_left_label_width+this.klass.LABEL_MARGIN*2;this._graph_left=this.left_margin+line_number_width+(this.y_axis_label===null?0.0:this._marker_caps_height+this.klass.LABEL_MARGIN*2);last_label=-Infinity;for(key in this.labels)last_label=last_label>Number(key)?last_label:Number(key);last_label=Math.round(last_label);extra_room_for_long_label=(last_label>=(this._column_count-1)&&this.center_labels_over_point)?this._calculate_width(this.marker_font_size,this.labels[last_label])/2:0.0;this._graph_right_margin=this.right_margin+extra_room_for_long_label;this._graph_bottom_margin=this.bottom_margin+this._marker_caps_height+this.klass.LABEL_MARGIN}this._graph_right=this._raw_columns-this._graph_right_margin;this._graph_width=this._raw_columns-this._graph_left-this._graph_right_margin;this._graph_top=this.top_margin+(this.hide_title?this.klass.TITLE_MARGIN:this._title_caps_height+this.klass.TITLE_MARGIN*2)+(this.hide_legend?this.klass.LEGEND_MARGIN:this._legend_caps_height+this.klass.LEGEND_MARGIN*2);x_axis_label_height=(this.x_axis_label===null)?0.0:this._marker_caps_height+this.klass.LABEL_MARGIN;this._graph_bottom=this._raw_rows-this._graph_bottom_margin-x_axis_label_height;this._graph_height=this._graph_bottom-this._graph_top},_draw_axis_labels:function(){if(this.x_axis_label){var a=this._graph_bottom+this.klass.LABEL_MARGIN*2+this._marker_caps_height;this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.stroke='transparent';this._d.pointsize=this._scale_fontsize(this.marker_font_size);this._d.gravity='north';this._d.annotate_scaled(this._raw_columns,1.0,0.0,a,this.x_axis_label,this._scale);this._debug(function(){this._d.line(0.0,a,this._raw_columns,a)})}},_draw_line_markers:function(){if(this.hide_line_markers)return;if(this.y_axis_increment===null){if(this.marker_count===null){Bluff.each([3,4,5,6,7],function(a){if(!this.marker_count&&this._spread%a==0)this.marker_count=a},this);this.marker_count=this.marker_count||4}this._increment=(this._spread>0)?this._significant(this._spread/this.marker_count):1}else{this.maximum_value=Math.max(Math.ceil(this.maximum_value),this.y_axis_increment);this.minimum_value=Math.floor(this.minimum_value);this._calculate_spread();this._normalize(true);this.marker_count=Math.round(this._spread/this.y_axis_increment);this._increment=this.y_axis_increment}this._increment_scaled=this._graph_height/(this._spread/this._increment);var b,n,y,marker_label;for(b=0,n=this.marker_count;b<=n;b++){y=this._graph_top+this._graph_height-b*this._increment_scaled;this._d.stroke=this.marker_color;this._d.stroke_width=1;this._d.line(this._graph_left,y,this._graph_right,y);marker_label=b*this._increment+this.minimum_value;if(!this.hide_line_numbers){this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.font_weight='normal';this._d.stroke='transparent';this._d.pointsize=this._scale_fontsize(this.marker_font_size);this._d.gravity='east';this._d.annotate_scaled(this._graph_left-this.klass.LABEL_MARGIN,1.0,0.0,y,this._label(marker_label),this._scale)}}},_center:function(a){return(this._raw_columns-a)/2},_draw_legend:function(){if(this.hide_legend)return;this._legend_labels=[];for(var i=0,n=this._data.length;i<n;i++)this._legend_labels.push(this._data[i][this.klass.DATA_LABEL_INDEX]);var e=this.legend_box_size;if(this.font)this._d.font=this.font;this._d.pointsize=this.legend_font_size;var f=[[]];Bluff.each(this._legend_labels,function(a){var b=f.length-1;var c=this._d.get_type_metrics(a);var d=c.width+e*2.7;f[b].push(d);if(Bluff.sum(f[b])>(this._raw_columns*0.9))f.push([f[b].pop()])},this);var g=this._center(Bluff.sum(f[0]));var h=this.hide_title?this.top_margin+this.klass.LEGEND_MARGIN:this.top_margin+this.klass.TITLE_MARGIN+this._title_caps_height+this.klass.LEGEND_MARGIN;this._debug(function(){this._d.stroke_width=1;this._d.line(0,h,this._raw_columns,h)});Bluff.each(this._legend_labels,function(a,b){this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.pointsize=this._scale_fontsize(this.legend_font_size);this._d.stroke='transparent';this._d.font_weight='normal';this._d.gravity='west';this._d.annotate_scaled(this._raw_columns,1.0,g+(e*1.7),h,a,this._scale);this._d.stroke='transparent';this._d.fill=this._data[b][this.klass.DATA_COLOR_INDEX];this._d.rectangle(g,h-e/2.0,g+e,h+e/2.0);this._d.pointsize=this.legend_font_size;var c=this._d.get_type_metrics(a);var d=c.width+(e*2.7),line_height;f[0].shift();if(f[0].length==0){this._debug(function(){this._d.line(0.0,h,this._raw_columns,h)});f.shift();if(f.length>0)g=this._center(Bluff.sum(f[0]));line_height=Math.max(this._legend_caps_height,e)+this.klass.LEGEND_MARGIN;if(f.length>0){h+=line_height;this._graph_top+=line_height;this._graph_height=this._graph_bottom-this._graph_top}}else{g+=d}},this);this._color_index=0},_draw_title:function(){if(this.hide_title||!this.title)return;this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.pointsize=this._scale_fontsize(this.title_font_size);this._d.font_weight='bold';this._d.gravity='north';this._d.annotate_scaled(this._raw_columns,1.0,0,this.top_margin,this.title,this._scale)},_draw_label:function(a,b){if(this.hide_line_markers)return;var c;if(this.labels[b]&&!this._labels_seen[b]){c=this._graph_bottom+this.klass.LABEL_MARGIN;this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.stroke='transparent';this._d.font_weight='normal';this._d.pointsize=this._scale_fontsize(this.marker_font_size);this._d.gravity='north';this._d.annotate_scaled(1.0,1.0,a,c,this.labels[b],this._scale);this._labels_seen[b]=true;this._debug(function(){this._d.stroke_width=1;this._d.line(0.0,c,this._raw_columns,c)})}},_draw_no_data:function(){this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.stroke='transparent';this._d.font_weight='normal';this._d.pointsize=this._scale_fontsize(80);this._d.gravity='center';this._d.annotate_scaled(this._raw_columns,this._raw_rows/2,0,10,this.no_data_message,this._scale)},_render_background:function(){var a=this._theme_options.background_colors;switch(true){case a instanceof Array:this._render_gradiated_background.apply(this,a);break;case typeof a=='string':this._render_solid_background(a);break;default:this._render_image_background(this._theme_options.background_image);break}},_render_solid_background:function(a){this._d.render_solid_background(this._columns,this._rows,a)},_render_gradiated_background:function(a,b){this._d.render_gradiated_background(this._columns,this._rows,a,b)},_render_image_background:function(a){},_reset_themes:function(){this._color_index=0;this._labels_seen={};this._theme_options={};this._d.scale(this._scale,this._scale)},_scale_value:function(a){return this._scale*a},_scale_fontsize:function(a){var b=a*this._scale;return b},_clip_value_if_greater_than:function(a,b){return(a>b)?b:a},_larger_than_max:function(a,b){return a>this.maximum_value},_less_than_min:function(a,b){return a<this.minimum_value},_max:function(a,b){return a},_min:function(a,b){return a},_significant:function(a){if(a==0)return 1.0;var b=1.0;while(a<10){a*=10;b/=10}while(a>100){a/=10;b*=10}return Math.floor(a)*b},_sort_norm_data:function(){var c=this._sums,index=this.klass.DATA_VALUES_INDEX;this._norm_data.sort(function(a,b){return c(b[index])-c(a[index])})},_sums:function(b){var c=0;Bluff.each(b,function(a){c+=a});return c},_make_stacked:function(){var d=[],i=this._column_count;while(i--)d[i]=0;Bluff.each(this._data,function(c){Bluff.each(c[this.klass.DATA_VALUES_INDEX],function(a,b){d[b]+=a},this);c[this.klass.DATA_VALUES_INDEX]=Bluff.array(d)},this)},_debug:function(a){if(this.klass.DEBUG){this._d.fill='transparent';this._d.stroke='turquoise';a.call(this)}},_increment_color:function(){if(this._color_index==0){this._color_index+=1;return this.colors[0]}else{if(this._color_index<this.colors.length){this._color_index+=1;return this.colors[this._color_index-1]}else{this._color_index=0;return this.colors[this.colors.length-1]}}},_label:function(a){if(this._spread%this.marker_count==0||this.y_axis_increment!==null){return String(Math.round(a))}return String(Math.floor(a*this._significant_digits)/this._significant_digits)},_calculate_caps_height:function(a){return this._d.caps_height(a)},_calculate_width:function(a,b){return this._d.text_width(a,b)}});Bluff.Area=new JS.Class(Bluff.Base,{draw:function(){this.callSuper();if(!this._has_data)return;this._x_increment=this._graph_width/(this._column_count-1);this._d.stroke='transparent';Bluff.each(this._norm_data,function(e){var f=[];var g=0.0,prev_y=0.0;Bluff.each(e[this.klass.DATA_VALUES_INDEX],function(a,b){var c=this._graph_left+(this._x_increment*b);var d=this._graph_top+(this._graph_height-a*this._graph_height);if(g>0&&prev_y>0){f.push(c);f.push(d)}else{f.push(this._graph_left);f.push(this._graph_bottom-1);f.push(c);f.push(d)}this._draw_label(c,b);g=c;prev_y=d},this);f.push(this._graph_right);f.push(this._graph_bottom-1);f.push(this._graph_left);f.push(this._graph_bottom-1);this._d.fill=e[this.klass.DATA_COLOR_INDEX];this._d.polyline(f)},this)}});Bluff.BarConversion=new JS.Class({mode:null,zero:null,graph_top:null,graph_height:null,minimum_value:null,spread:null,getLeftYRightYscaled:function(a,b){var c;switch(this.mode){case 1:b[0]=this.graph_top+this.graph_height*(1-a)+1;b[1]=this.graph_top+this.graph_height-1;break;case 2:b[0]=this.graph_top+1;b[1]=this.graph_top+this.graph_height*(1-a)-1;break;case 3:c=a-this.minimum_value/this.spread;if(a>=this.zero){b[0]=this.graph_top+this.graph_height*(1-(c-this.zero))+1;b[1]=this.graph_top+this.graph_height*(1-this.zero)-1}else{b[0]=this.graph_top+this.graph_height*(1-(c-this.zero))+1;b[1]=this.graph_top+this.graph_height*(1-this.zero)-1}break;default:b[0]=0.0;b[1]=0.0}}});Bluff.Bar=new JS.Class(Bluff.Base,{draw:function(){var a=0,key;for(key in this.labels)a+=1;this.center_labels_over_point=(a>this._column_count);this.callSuper();if(!this._has_data)return;this._draw_bars()},_draw_bars:function(){var i=(this._column_count<3)?0.3:0.9;if(this.spacing_factor){i=this.spacing_factor}this._bar_width=this._graph_width/(this._column_count*this._data.length);var j=(this._bar_width*(1-i))/2;this._d.stroke_opacity=0.0;var k=new Bluff.BarConversion();k.graph_height=this._graph_height;k.graph_top=this._graph_top;if(this.minimum_value>=0){k.mode=1}else{if(this.maximum_value<=0){k.mode=2}else{k.mode=3;k.spread=this._spread;k.minimum_value=this.minimum_value;k.zero=-this.minimum_value/this._spread}}Bluff.each(this._norm_data,function(g,h){Bluff.each(g[this.klass.DATA_VALUES_INDEX],function(a,b){var c=this._graph_left+(this._bar_width*(h+b+((this._data.length-1)*b)))+j;var d=c+this._bar_width*i;var e=[];k.getLeftYRightYscaled(a,e);this._d.fill=g[this.klass.DATA_COLOR_INDEX];this._d.stroke='transparent';this._d.rectangle(c,e[0],d,e[1]);var f=this._graph_left+(this._data.length*this._bar_width*b)+(this._data.length*this._bar_width/2.0)+j;this._draw_label(f-(this.center_labels_over_point?this._bar_width/2.0:0.0),b)},this)},this);if(this.center_labels_over_point)this._draw_label(this._graph_right,this._column_count)}});Bluff.Line=new JS.Class(Bluff.Base,{baseline_value:null,baseline_color:null,hide_dots:null,hide_lines:null,initialize:function(a){if(arguments.length>3)throw'Wrong number of arguments';if(arguments.length==1||(typeof arguments[1]!='number'&&typeof arguments[1]!='string'))this.callSuper(a,null);else this.callSuper();this.hide_dots=this.hide_lines=false;this.baseline_color='red';this.baseline_value=null},draw:function(){this.callSuper();if(!this._has_data)return;this.x_increment=(this._column_count>1)?(this._graph_width/(this._column_count-1)):this._graph_width;var h;if(this._norm_baseline!==undefined){h=this._graph_top+(this._graph_height-this._norm_baseline*this._graph_height);this._d.push();this._d.stroke=this.baseline_color;this._d.stroke_width=3.0;this._d.line(this._graph_left,h,this._graph_left+this._graph_width,h);this._d.pop()}Bluff.each(this._norm_data,function(f){var g=null,prev_y=null;Bluff.each(f[this.klass.DATA_VALUES_INDEX],function(a,b){var c=this._graph_left+(this.x_increment*b);if(a===undefined)return;this._draw_label(c,b);var d=this._graph_top+(this._graph_height-a*this._graph_height);this._d.stroke=f[this.klass.DATA_COLOR_INDEX];this._d.fill=f[this.klass.DATA_COLOR_INDEX];this._d.stroke_opacity=1.0;this._d.stroke_width=this._clip_value_if_greater_than(this._columns/(this._norm_data[0][1].length*6),3.0);if(!this.hide_lines&&g!==null&&prev_y!==null)this._d.line(g,prev_y,c,d);var e=this._clip_value_if_greater_than(this._columns/(this._norm_data[0][1].length*2),7.0);if(!this.hide_dots)this._d.circle(c,d,c-e,d);g=c;prev_y=d},this)},this)},_normalize:function(){this.maximum_value=Math.max(this.maximum_value,this.baseline_value);this.callSuper();if(this.baseline_value!==null)this._norm_baseline=this.baseline_value/this.maximum_value}});Bluff.Net=new JS.Class(Bluff.Base,{hide_dots:null,initialize:function(){this.callSuper();this.hide_dots=false},draw:function(){this.callSuper();if(!this._has_data)return;this._radius=this._graph_height/2.0;this._center_x=this._graph_left+(this._graph_width/2.0);this._center_y=this._graph_top+(this._graph_height/2.0)-10;this._x_increment=this._graph_width/(this._column_count-1);var f=this._clip_value_if_greater_than(this._columns/(this._norm_data[0][this.klass.DATA_VALUES_INDEX].length*2.5),7.0);this._d.stroke_opacity=1.0;this._d.stroke_width=this._clip_value_if_greater_than(this._columns/(this._norm_data[0][this.klass.DATA_VALUES_INDEX].length*4),3.0);var g;if(this._norm_baseline!==undefined){g=this._graph_top+(this._graph_height-this._norm_baseline*this._graph_height);this._d.push();this._d.stroke_color=this.baseline_color;this._d.fill_opacity=0.0;this._d.stroke_width=5;this._d.line(this._graph_left,g,this._graph_left+this._graph_width,g);this._d.pop()}Bluff.each(this._norm_data,function(d){var e=null,prev_y=null;Bluff.each(d[this.klass.DATA_VALUES_INDEX],function(a,b){if(a===undefined)return;var c=b*Math.PI*2/this._column_count,point_distance=a*this._radius,start_x=this._center_x+Math.sin(c)*point_distance,start_y=this._center_y-Math.cos(c)*point_distance,next_index=(b+1<d[this.klass.DATA_VALUES_INDEX].length)?b+1:0,next_rad_pos=next_index*Math.PI*2/this._column_count,next_point_distance=d[this.klass.DATA_VALUES_INDEX][next_index]*this._radius,end_x=this._center_x+Math.sin(next_rad_pos)*next_point_distance,end_y=this._center_y-Math.cos(next_rad_pos)*next_point_distance;this._d.stroke=d[this.klass.DATA_COLOR_INDEX];this._d.fill=d[this.klass.DATA_COLOR_INDEX];this._d.line(start_x,start_y,end_x,end_y);if(!this.hide_dots)this._d.circle(start_x,start_y,start_x-f,start_y)},this)},this)},_draw_line_markers:function(){if(this.hide_line_markers)return;this._radius=this._graph_height/2.0;this._center_x=this._graph_left+(this._graph_width/2.0);this._center_y=this._graph_top+(this._graph_height/2.0)-10;var a,marker_label;for(var b=0,n=this._column_count;b<n;b++){a=b*Math.PI*2/this._column_count;this._d.stroke=this.marker_color;this._d.stroke_width=1;this._d.line(this._center_x,this._center_y,this._center_x+Math.sin(a)*this._radius,this._center_y-Math.cos(a)*this._radius);marker_label=labels[b]?labels[b]:'000';this._draw_label(this._center_x,this._center_y,a*360/(2*Math.PI),this._radius,marker_label)}},_draw_label:function(a,b,c,d,e){var f=1.1,x_offset=a,y_offset=b,rad_pos=c*Math.PI/180,x=x_offset+(d*f*Math.sin(rad_pos)),y=y_offset-(d*f*Math.cos(rad_pos));this._d.fill=this.marker_color;if(this.font)this._d.font=this.font;this._d.pointsize=this._scale_fontsize(20);this._d.stroke='transparent';this._d.font_weight='bold';var s=rad_pos/(2*Math.PI);switch(true){case s>=0.96||s<0.04:this._d.gravity='south';break;case s>=0.04&&s<0.21:this._d.gravity='west';break;case s>=0.21&&s<0.29:this._d.gravity='west';break;case s>=0.29&&s<0.46:this._d.gravity='west';break;case s>=0.46&&s<0.54:this._d.gravity='north';break;case s>=0.54&&s<0.71:this._d.gravity='east';break;case s>=0.71&&s<0.79:this._d.gravity='east';break;case s>=0.79&&s<0.96:this._d.gravity='east';break}this._d.annotate_scaled(0,0,x,y,e,this._scale)}});Bluff.Pie=new JS.Class(Bluff.Base,{extend:{TEXT_OFFSET_PERCENTAGE:0.15},zero_degreee:null,initialize_ivars:function(){this.callSuper();this.zero_degree=0.0},draw:function(){this.hide_line_markers=true;this.callSuper();if(!this._has_data)return;var e=this._graph_height,radius=(Math.min(this._graph_width,this._graph_height)/2)*0.8,top_x=this._graph_left+(this._graph_width-e)/2,center_x=this._graph_left+(this._graph_width/2),center_y=this._graph_top+(this._graph_height/2)-10,total_sum=this._sums_for_pie(),prev_degrees=this.zero_degree,index=this.klass.DATA_VALUES_INDEX;if(this.sort)this._data.sort(function(a,b){return a[index][0]-b[index][0]});Bluff.each(this._data,function(a,i){if(a[this.klass.DATA_VALUES_INDEX][0]>0){this._d.fill=a[this.klass.DATA_COLOR_INDEX];var b=(a[this.klass.DATA_VALUES_INDEX][0]/total_sum)*360;this._d.circle(center_x,center_y,center_x+radius,center_y,prev_degrees,prev_degrees+b+0.5);var c=prev_degrees+((prev_degrees+b)-prev_degrees)/2;var d=Math.round((a[this.klass.DATA_VALUES_INDEX][0]/total_sum)*100.0)+'%';this._draw_label(center_x,center_y,c,radius+(radius*this.klass.TEXT_OFFSET_PERCENTAGE),d);prev_degrees+=b}},this)},_draw_label:function(a,b,c,d,e){var f=20.0,x_offset=a,y_offset=b,radius_offset=d+f,ellipse_factor=radius_offset*0.15,x=x_offset+((radius_offset+ellipse_factor)*Math.cos(c*Math.PI/180)),y=y_offset+(radius_offset*Math.sin(c*Math.PI/180));this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.pointsize=this._scale_fontsize(this.marker_font_size);this._d.font_weight='bold';this._d.gravity='center';this._d.annotate_scaled(0,0,x,y,e,this._scale)},_sums_for_pie:function(){var b=0;Bluff.each(this._data,function(a){b+=a[this.klass.DATA_VALUES_INDEX][0]},this);return b}});Bluff.SideBar=new JS.Class(Bluff.Base,{draw:function(){this.has_left_labels=true;this.callSuper();if(!this._has_data)return;var g=0.9;this._bars_width=this._graph_height/this._column_count;this._bar_width=this._bars_width*g/this._norm_data.length;this._d.stroke_opacity=0.0;var h=[],i=this._column_count;while(i--)h[i]=0;var k=[],j=this._column_count;while(j--)k[j]=this._graph_left;var l=(this._bars_width*(1-g))/2;Bluff.each(this._norm_data,function(e,f){Bluff.each(e[this.klass.DATA_VALUES_INDEX],function(a,b){var c=this._graph_left+(this._graph_width-a*this._graph_width-h[b]),temp2=this._graph_left+this._graph_width-h[b],difference=temp2-c,left_x=k[b]-1,left_y=this._graph_top+(this._bars_width*b)+(this._bar_width*f)+l,right_x=left_x+difference,right_y=left_y+this._bar_width;h[b]+=(a*this._graph_width);this._d.stroke='transparent';this._d.fill=e[this.klass.DATA_COLOR_INDEX];this._d.rectangle(left_x,left_y,right_x,right_y);var d=this._graph_top+(this._bars_width*b+this._bars_width/2)+l;this._draw_label(d,b)},this)},this)},_draw_line_markers:function(){if(this.hide_line_markers)return;this._d.stroke_width=1;var a=5;var b=this._significant(this.maximum_value/a),line_diff,x,diff,marker_label;for(var c=0;c<=a;c++){line_diff=(this._graph_right-this._graph_left)/a;x=this._graph_right-(line_diff*c)-1;diff=c-a;marker_label=Math.abs(diff)*b;this._d.stroke=this.marker_color;this._d.line(x,this._graph_bottom,x,this._graph_top);if(!this.hide_line_numbers){this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.stroke='transparent';this._d.pointsize=this._scale_fontsize(this.marker_font_size);this._d.gravity='center';this._d.annotate_scaled(0,0,x,this._graph_bottom+(this.klass.LABEL_MARGIN*2.0),marker_label,this._scale)}}},_draw_label:function(a,b){if(this.labels[b]&&!this._labels_seen[b]){this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.stroke='transparent';this._d.font_weight='normal';this._d.pointsize=this._scale_fontsize(this.marker_font_size);this._d.gravity='east';this._d.annotate_scaled(1,1,this._graph_left-this.klass.LABEL_MARGIN*2.0,a,this.labels[b],this._scale);this._labels_seen[b]=true}}});Bluff.Spider=new JS.Class(Bluff.Base,{hide_text:null,hide_axes:null,transparent_background:null,initialize:function(a,b,c){this.callSuper(a,c);this._max_value=b;this.hide_legend=true},draw:function(){this.hide_line_markers=true;this.callSuper();if(!this._has_data)return;var a=this._graph_height,radius=this._graph_height/2.0,top_x=this._graph_left+(this._graph_width-a)/2.0,center_x=this._graph_left+(this._graph_width/2.0),center_y=this._graph_top+(this._graph_height/2.0)-25;this._unit_length=radius/this._max_value;var b=this._sums_for_spider(),prev_degrees=0.0,additive_angle=(2*Math.PI)/this._data.length,current_angle=0.0;if(!this.hide_axes)this._draw_axes(center_x,center_y,radius,additive_angle);this._draw_polygon(center_x,center_y,additive_angle)},_normalize_points:function(a){return a*this._unit_length},_draw_label:function(a,b,c,d,e){var f=50,x_offset=a,y_offset=b+0,x=x_offset+((d+f)*Math.cos(c)),y=y_offset+((d+f)*Math.sin(c));this._d.fill=this.marker_color;if(this.font)this._d.font=this.font;this._d.pointsize=this._scale_fontsize(this.legend_font_size);this._d.stroke='transparent';this._d.font_weight='bold';this._d.gravity='center';this._d.annotate_scaled(0,0,x,y,e,this._scale)},_draw_axes:function(d,e,f,g,h){if(this.hide_axes)return;var i=0.0;Bluff.each(this._data,function(a){this._d.stroke=h||a[this.klass.DATA_COLOR_INDEX];this._d.stroke_width=5.0;var b=f*Math.cos(i);var c=f*Math.sin(i);this._d.line(d,e,d+b,e+c);if(!this.hide_text)this._draw_label(d,e,i,f,a[this.klass.DATA_LABEL_INDEX]);i+=g},this)},_draw_polygon:function(b,c,d,e){var f=[],current_angle=0.0;Bluff.each(this._data,function(a){f.push(b+this._normalize_points(a[this.klass.DATA_VALUES_INDEX][0])*Math.cos(current_angle));f.push(c+this._normalize_points(a[this.klass.DATA_VALUES_INDEX][0])*Math.sin(current_angle));current_angle+=d},this);this._d.stroke_width=1.0;this._d.stroke=e||this.marker_color;this._d.fill=e||this.marker_color;this._d.fill_opacity=0.4;this._d.polyline(f)},_sums_for_spider:function(){var b=0.0;Bluff.each(this._data,function(a){b+=a[this.klass.DATA_VALUES_INDEX][0]},this);return b}});Bluff.Base.StackedMixin=new JS.Module({_get_maximum_by_stack:function(){var c={};Bluff.each(this._data,function(b){Bluff.each(b[this.klass.DATA_VALUES_INDEX],function(a,i){if(!c[i])c[i]=0.0;c[i]+=a},this)},this);for(var d in c){if(c[d]>this.maximum_value)this.maximum_value=c[d]}this.minimum_value=0}});Bluff.StackedArea=new JS.Class(Bluff.Base,{include:Bluff.Base.StackedMixin,last_series_goes_on_bottom:null,draw:function(){this._get_maximum_by_stack();this.callSuper();if(!this._has_data)return;this._x_increment=this._graph_width/(this._column_count-1);this._d.stroke='transparent';var h=[],i=this._column_count;while(i--)h.push(0);var j=null;var k=this.last_series_goes_on_bottom?'reverse_each':'each';Bluff[k](this._norm_data,function(e){var f=j;j=[];Bluff.each(e[this.klass.DATA_VALUES_INDEX],function(a,b){var c=this._graph_left+(this._x_increment*b);var d=this._graph_top+(this._graph_height-a*this._graph_height-h[b]);h[b]+=(a*this._graph_height);j.push(c);j.push(d);this._draw_label(c,b)},this);var g,i,n;if(f){g=Bluff.array(j);for(i=f.length/2-1;i>=0;i--){g.push(f[2*i]);g.push(f[2*i+1])}g.push(j[0]);g.push(j[1])}else{g=Bluff.array(j);g.push(this._graph_right);g.push(this._graph_bottom-1);g.push(this._graph_left);g.push(this._graph_bottom-1);g.push(j[0]);g.push(j[1])}this._d.fill=e[this.klass.DATA_COLOR_INDEX];this._d.polyline(g)},this)}});Bluff.StackedBar=new JS.Class(Bluff.Base,{include:Bluff.Base.StackedMixin,draw:function(){this._get_maximum_by_stack();this.callSuper();if(!this._has_data)return;var j=0.9;this._bar_width=this._graph_width/this._column_count;var k=(this._bar_width*(1-j))/2;var l=[],i=this._column_count;while(i--)l.push(0);Bluff.each(this._norm_data,function(h,i){Bluff.each(h[this.klass.DATA_VALUES_INDEX],function(a,b){var c=this._graph_left+(this._bar_width*b)+(this._bar_width*j/2.0)+k;this._draw_label(c,b);if(a==0)return;var d=this._graph_left+(this._bar_width*b)+k;var e=this._graph_top+(this._graph_height-a*this._graph_height-l[b])+1;var f=d+this._bar_width*j;var g=this._graph_top+this._graph_height-l[b]-1;l[b]+=(a*this._graph_height);this._d.fill=h[this.klass.DATA_COLOR_INDEX];this._d.rectangle(d,e,f,g)},this)},this)}});Bluff.AccumulatorBar=new JS.Class(Bluff.StackedBar,{draw:function(){if(this._data.length!=1)throw'Incorrect number of datasets exception';var c=[];var d=0;var e=[];Bluff.each(this._data[0][this.klass.DATA_VALUES_INDEX],function(a){var b=-Infinity;Bluff.each(e,function(x){b=Math.max(b,x)});e.push((d>0)?(a+b):a);c.push(e[d]-a);d+=1},this);this.data("Accumulator",c);this.callSuper()}});Bluff.SideStackedBar=new JS.Class(Bluff.SideBar,{include:Bluff.Base.StackedMixin,draw:function(){this.has_left_labels=true;this._get_maximum_by_stack();this.callSuper();if(!this._has_data)return;var k=0.9;this._bar_width=this._graph_height/this._column_count;var l=[],i=this._column_count,length=[],j=this._column_count,padding=(this._bar_width*(1-k))/2;while(i--)l.push(0);while(j--)length.push(this._graph_left);Bluff.each(this._norm_data,function(h,i){this._d.fill=h[this.klass.DATA_COLOR_INDEX];Bluff.each(h[this.klass.DATA_VALUES_INDEX],function(a,b){var c=this._graph_left+(this._graph_width-a*this._graph_width-l[b])+1;var d=this._graph_left+this._graph_width-l[b]-1;var e=d-c;var f=length[b],left_y=this._graph_top+(this._bar_width*b)+padding,right_x=f+e,right_y=left_y+this._bar_width*k;length[b]+=e;l[b]+=(a*this._graph_width-2);this._d.rectangle(f,left_y,right_x,right_y);var g=this._graph_top+(this._bar_width*b)+(this._bar_width*k/2.0)+padding;this._draw_label(g,b)},this)},this)},_larger_than_max:function(a,b){b=b||0;return this._max(a,b)>this.maximum_value},_max:function(b,c){var d=0;Bluff.each(this._data,function(a){d+=a[this.klass.DATA_VALUES_INDEX][c]},this);return d}});Bluff.Mini.Legend=new JS.Module({hide_mini_legend:false,_expand_canvas_for_vertical_legend:function(){if(this.hide_mini_legend)return;this._original_rows=this._raw_rows;this._rows+=this._data.length*this._calculate_caps_height(this._scale_fontsize(this.legend_font_size))*1.7;this._render_background()},_draw_vertical_legend:function(){if(this.hide_mini_legend)return;this._legend_labels=[];Bluff.each(this._data,function(a){this._legend_labels.push(a[this.klass.DATA_LABEL_INDEX])},this);var c=40.0,legend_square_margin=10.0,legend_left_margin=100.0,legend_top_margin=40.0;if(this.font)this._d.font=this.font;this._d.pointsize=this.legend_font_size;var d=legend_left_margin,current_y_offset=this._original_rows+legend_top_margin;this._debug(function(){this._d.line(0.0,current_y_offset,this._raw_columns,current_y_offset)});Bluff.each(this._legend_labels,function(a,b){this._d.fill=this.font_color;if(this.font)this._d.font=this.font;this._d.pointsize=this._scale_fontsize(this.legend_font_size);this._d.stroke='transparent';this._d.font_weight='normal';this._d.gravity='west';this._d.annotate_scaled(this._raw_columns,1.0,d+(c*1.7),current_y_offset,this._truncate_legend_label(a),this._scale);this._d.stroke='transparent';this._d.fill=this._data[b][this.klass.DATA_COLOR_INDEX];this._d.rectangle(d,current_y_offset-c/2.0,d+c,current_y_offset+c/2.0);current_y_offset+=this._calculate_caps_height(this.legend_font_size)*1.7},this);this._color_index=0},_truncate_legend_label:function(a){var b=String(a);while(this._calculate_width(this._scale_fontsize(this.legend_font_size),b)>(this._columns-this.legend_left_margin-this.right_margin)&&(b.length>1))b=b.substr(0,b.length-1);return b+(b.length<String(a).length?"…":'')}});Bluff.Mini.Bar=new JS.Class(Bluff.Bar,{include:Bluff.Mini.Legend,initialize_ivars:function(){this.callSuper();this.hide_legend=true;this.hide_title=true;this.hide_line_numbers=true;this.marker_font_size=50.0;this.minimum_value=0.0;this.maximum_value=0.0;this.legend_font_size=60.0},draw:function(){this._expand_canvas_for_vertical_legend();this.callSuper();this._draw_vertical_legend()}});Bluff.Mini.Pie=new JS.Class(Bluff.Pie,{include:Bluff.Mini.Legend,initialize_ivars:function(){this.callSuper();this.hide_legend=true;this.hide_title=true;this.hide_line_numbers=true;this.marker_font_size=60.0;this.legend_font_size=60.0},draw:function(){this._expand_canvas_for_vertical_legend();this.callSuper();this._draw_vertical_legend()}});Bluff.Mini.SideBar=new JS.Class(Bluff.SideBar,{include:Bluff.Mini.Legend,initialize_ivars:function(){this.callSuper();this.hide_legend=true;this.hide_title=true;this.hide_line_numbers=true;this.marker_font_size=50.0;this.legend_font_size=50.0},draw:function(){this._expand_canvas_for_vertical_legend();this.callSuper();this._draw_vertical_legend()}});Bluff.Renderer=new JS.Class({extend:{WRAPPER_CLASS:'bluff-wrapper',TEXT_CLASS:'bluff-text'},font:'Arial, Helvetica, Verdana, sans-serif',gravity:'north',initialize:function(a){this._canvas=document.getElementById(a);this._ctx=this._canvas.getContext('2d')},scale:function(a,b){this._sx=a;this._sy=b||a},caps_height:function(a){var X=this._sized_text(a,'X'),height=this._element_size(X).height;this._remove_text_node(X);return height},text_width:function(a,b){var c=this._sized_text(a,b);var d=this._element_size(c).width;this._remove_text_node(c);return d},get_type_metrics:function(a){var b=this._sized_text(this.pointsize,a);document.body.appendChild(b);var c=this._element_size(b);this._remove_text_node(b);return c},clear:function(a,b){this._canvas.width=a;this._canvas.height=b;this._ctx.clearRect(0,0,a,b);var c=this._text_container(),children=c.childNodes,i=children.length;c.style.width=a+'px';c.style.height=b+'px';while(i--){if(children[i]&&children[i].className==this.klass.TEXT_CLASS)this._remove_text_node(children[i])}},push:function(){this._ctx.save()},pop:function(){this._ctx.restore()},render_gradiated_background:function(a,b,c,d){this.clear(a,b);var e=this._ctx.createLinearGradient(0,0,0,b);e.addColorStop(0,c);e.addColorStop(1,d);this._ctx.fillStyle=e;this._ctx.fillRect(0,0,a,b)},render_solid_background:function(a,b,c){this.clear(a,b);this._ctx.fillStyle=c;this._ctx.fillRect(0,0,a,b)},annotate_scaled:function(a,b,x,y,c,d){var e=(a*d)>=1?(a*d):1;var f=(b*d)>=1?(b*d):1;var c=this._sized_text(this.pointsize,c);c.style.color=this.fill;c.style.fontWeight=this.font_weight;c.style.textAlign='center';c.style.left=(this._sx*x+this._left_adjustment(c,e))+'px';c.style.top=(this._sy*y+this._top_adjustment(c,f))+'px'},circle:function(a,b,c,d,e,f){var g=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2));this._ctx.fillStyle=this.fill;this._ctx.beginPath();var h=(e||0)*Math.PI/180;var i=(f||360)*Math.PI/180;if(e!==undefined&&f!==undefined){this._ctx.moveTo(this._sx*(a+g*Math.cos(i)),this._sy*(b+g*Math.sin(i)));this._ctx.lineTo(this._sx*a,this._sy*b);this._ctx.lineTo(this._sx*(a+g*Math.cos(h)),this._sy*(b+g*Math.sin(h)))}this._ctx.arc(this._sx*a,this._sy*b,this._sx*g,h,i,false);this._ctx.fill()},line:function(a,b,c,d){this._ctx.strokeStyle=this.stroke;this._ctx.lineWidth=this.stroke_width;this._ctx.beginPath();this._ctx.moveTo(this._sx*a,this._sy*b);this._ctx.lineTo(this._sx*c,this._sy*d);this._ctx.stroke()},polyline:function(a){this._ctx.fillStyle=this.fill;this._ctx.globalAlpha=this.fill_opacity||1;try{this._ctx.strokeStyle=this.stroke}catch(e){}var x=a.shift(),y=a.shift();this._ctx.beginPath();this._ctx.moveTo(this._sx*x,this._sy*y);while(a.length>0){x=a.shift();y=a.shift();this._ctx.lineTo(this._sx*x,this._sy*y)}this._ctx.fill()},rectangle:function(a,b,c,d){var f;if(a>c){f=a;a=c;c=f}if(b>d){f=b;b=d;d=f}try{this._ctx.fillStyle=this.fill;this._ctx.fillRect(this._sx*a,this._sy*b,this._sx*(c-a),this._sy*(d-b))}catch(e){}try{this._ctx.strokeStyle=this.stroke;if(this.stroke!='transparent')this._ctx.strokeRect(this._sx*a,this._sy*b,this._sx*(c-a),this._sy*(d-b))}catch(e){}},_left_adjustment:function(a,b){var w=this._element_size(a).width;switch(this.gravity){case'west':return 0;case'east':return b-w;case'north':case'south':case'center':return(b-w)/2}},_top_adjustment:function(a,b){var h=this._element_size(a).height;switch(this.gravity){case'north':return 0;case'south':return b-h;case'west':case'east':case'center':return(b-h)/2}},_text_container:function(){var a=this._canvas.parentNode;if(a.className==this.klass.WRAPPER_CLASS)return a;a=document.createElement('div');a.className=this.klass.WRAPPER_CLASS;a.style.position='relative';a.style.border='none';a.style.padding='0 0 0 0';this._canvas.parentNode.insertBefore(a,this._canvas);a.appendChild(this._canvas);return a},_sized_text:function(a,b){var c=this._text_node(b);c.style.fontFamily=this.font;c.style.fontSize=(typeof a=='number')?a+'px':a;return c},_text_node:function(a){var b=document.createElement('div');b.className=this.klass.TEXT_CLASS;b.style.position='absolute';b.appendChild(document.createTextNode(a));this._text_container().appendChild(b);return b},_remove_text_node:function(a){a.parentNode.removeChild(a)},_element_size:function(a){var b=a.style.display;return(b&&b!='none')?{width:a.offsetWidth,height:a.offsetHeight}:{width:a.clientWidth,height:a.clientHeight}}});Bluff.TableReader=new JS.Class({NUMBER_FORMAT:/\-?(0|[1-9]\d*)(\.\d+)?(e[\+\-]?\d+)?/i,initialize:function(a,b){this._table=(typeof a=='string')?document.getElementById(a):a;this._swap=!!b},get_data:function(){if(!this._data)this._read();return this._data},get_labels:function(){if(!this._labels)this._read();return this._labels},get_title:function(){return this._title},get_series:function(i){if(this._data[i])return this._data[i];return this._data[i]={points:[]}},_read:function(){this._row=this._col=0;this._row_offset=this._col_offset=0;this._data=[];this._labels={};this._row_headings=[];this._col_headings=[];this._walk(this._table);if((this._row_headings.length>1&&this._col_headings.length==1)||this._row_headings.length<this._col_headings.length){if(!this._swap)this._transpose()}else{if(this._swap)this._transpose()}Bluff.each(this._col_headings,function(a,i){this.get_series(i-this._col_offset).name=a},this);Bluff.each(this._row_headings,function(a,i){this._labels[i-this._row_offset]=a},this)},_walk:function(a){this._visit(a);var i,children=a.childNodes,n=children.length;for(i=0;i<n;i++)this._walk(children[i])},_visit:function(a){if(!a.tagName)return;var b=this._strip_tags(a.innerHTML),x,y;switch(a.tagName.toUpperCase()){case'TR':if(!this._has_data)this._row_offset=this._row;this._row+=1;this._col=0;break;case'TD':if(!this._has_data)this._col_offset=this._col;this._col+=1;b=parseFloat(b.match(this.NUMBER_FORMAT)[0]);if(typeof b=='number'){this._has_data=true;x=this._col-this._col_offset-1;y=this._row-this._row_offset-1;this.get_series(x).points[y]=parseFloat(b)}break;case'TH':this._col+=1;if(this._col==1&&this._row==1)this._row_headings[0]=this._col_headings[0]=b;else if(a.scope=="row"||this._col==1)this._row_headings[this._row-1]=b;else this._col_headings[this._col-1]=b;break;case'CAPTION':this._title=b;break}},_transpose:function(){var c=this._data,tmp;this._data=[];Bluff.each(c,function(b,i){Bluff.each(b.points,function(a,p){this.get_series(p).points[i]=a},this)},this);tmp=this._row_headings;this._row_headings=this._col_headings;this._col_headings=tmp;tmp=this._row_offset;this._row_offset=this._col_offset;this._col_offset=tmp},_strip_tags:function(a){return a.replace(/<\/?[^>]+>/gi,'')},extend:{Mixin:new JS.Module({data_from_table:function(b,c){var d=new Bluff.TableReader(b,c),data_rows=d.get_data();Bluff.each(data_rows,function(a){this.data(a.name,a.points)},this);this.labels=d.get_labels();this.title=d.get_title()||this.title}})}});Bluff.Base.include(Bluff.TableReader.Mixin);