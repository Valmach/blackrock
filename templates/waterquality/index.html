{% extends 'base.html' %}

{% load render %}

{% block title %}Water Quality{% endblock %}

{% block js %}

	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/themes/base/jquery-ui.css" type="text/css" media="all" /> 
	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/jquery-ui.min.js" type="text/javascript"></script>
	<script src="/site_media/js/facebox.js" type="text/javascript"></script>
	<script src="/site_media/js/highcharts.js" type="text/javascript"></script>
	<script src="/site_media/js/modules/exporting.js" type="text/javascript"></script>

	{% if not show_graph %}
	<script type="text/javascript">
	$(document).ready(function() {
		$('a[rel*=facebox]').facebox();   
	})
	</script>
	{% endif %}

	{% if show_graph %}
	<script type="text/javascript">
	var chart;
	$(document).ready(function() {
        $('a[rel*=facebox]').facebox();
	$("#start").datepicker({dateFormat: 'yy-mm-dd',
                                minDate: Date.UTC(2009, 3, 24),
	                        maxDate: Date.UTC(2009, 8, 06),
	yearRange: '2009:2009'
	});
	$("#end").datepicker({dateFormat: 'yy-mm-dd',
        minDate: Date.UTC(2009, 3, 24),
	maxDate: Date.UTC(2009, 8, 06)});
	   chart = new Highcharts.Chart({
		 chart: {
		    renderTo: 'chart-container',
	{% ifequal type "scatter-plot" %}
		    defaultSeriesType: 'scatter',
	{% endifequal %}
		    spacingRight: 20
		 },
		  title: {
		    text: '{{graph_title}}'
		 },
	{% ifequal type "time-series" %}
		 xAxis: {
		    type: 'datetime',
		    title: {
			  text: null
		    }
		 },
	{% endifequal %}
	{% ifequal type "scatter-plot" %}
		 xAxis: {
		    title: {
			  enabled: true,
			  text: '{{independent.name}} ({{independent.units}})'
		    },
		    startOnTick: true,
		    endOnTick: true,
		    showLastLabel: true
		 },
		 yAxis: {
		    title: {
			  text: '{{dependent.name}} ({{dependent.units}})'
		    }
		 },
	
	{% endifequal %}
		 tooltip: {
	{% ifequal type "time-series" %}
		    shared: true               
	{% else %}
	            shared: false
	{% endifequal %}
		 },
		 legend: {
		    enabled: true
		 },
		 plotOptions: {
		    area: {
			  fillColor: {
				linearGradient: [0, 0, 0, 300],
				stops: [
				   [0, 'rgba(100,0,6,0)'],
				   [1, 'rgba(2,0,100,0)']
				]
			  },
			  lineWidth: 1,
			  marker: {
				enabled: false,
				states: {
				   hover: {
					 enabled: true,
					 radius: 5
				   }
				}
			  },
			  shadow: false,
			  states: {
				hover: {
				   lineWidth: 1                  
				}
			  }
		    },
		    scatter: {
			  marker: {
				radius: 5,
				states: {
				   hover: {
					 enabled: true,
					 lineColor: 'rgb(100,100,100)'
				   }
				}
			  },
			  states: {
				hover: {
				   marker: {
					 enabled: false
				   }
				}
			  }
		    }
	
		 },
	{% ifequal type "time-series" %}
		 series: [
	{% for set in datasets %}
		  {
		    type: 'area',
		    name: '{{set.series.name}} ({{set.series.units}})',
		    pointInterval: 3600 * 1000,
		    pointStart: Date.UTC({{start.year}}, {{start.month}} - 1, {{start.day}}),
		    data: [
			 {% for point in set.data %}{{point}}{% if not forloop.last %},{% endif %}{% endfor %}
		    ]
		 }{% if not forloop.last %},{% endif %}{% if forloop.last %}{% if lines %},{% endif %}{% endif %}
	{% endfor %}
	
	 {% for line in lines %} 
	   {
		    name: '{{line.label}}',
		    type: 'line',
		    data: [[Date.UTC({{start.year}}, {{start.month}} - 1, {{start.day}}), {{line.value}}], [Date.UTC({{end.year}}, {{end.month}} - 1, {{end.day}}), {{line.value}}]],
		    marker: {
			  enabled: false
		    },
		    states: {
			  hover: {
				lineWidth: 0
			  }
		    },
		    enableMouseTracking: false
		 }{% if not forloop.last %},{% endif %}
	
	{% endfor %} 
		 ],
	{% endifequal %}
	
	{% ifequal type "scatter-plot" %}
		 series: [{
		    name: '{{dependent.name}} vs {{independent.name}}',
		    color: 'rgba(223, 83, 83, .5)',
		    data: [{% for point in data %}[{{point.0}},{{point.1}}]{% if not forloop.last %},{% endif %}
	{% endfor %}
	   ]
	   
		 },
	
	   {
		    type: 'line',
		    name: 'Regression Line',
	{% with lseriesp.regression_line_points as lrp %}
		    data: [[{{lrp.0.0}}, {{lrp.0.1}}], [{{lrp.1.0}}, {{lrp.1.1}}]],
	{% endwith %}
		    marker: {
			  enabled: false
		    },
		    states: {
			  hover: {
				lineWidth: 0
			  }
		    },
		    enableMouseTracking: false
		 }{% if lines %},{% endif %}
	
	 {% for line in lines %} 
	   {
		    name: '{{line.label}}',
		    type: 'line',
		    data: [[{{lseriesp.independent.min}}, {{line.value}}], [{{lseriesp.independent.max}}, {{line.value}}]],
		    marker: {
			  enabled: false
		    },
		    states: {
			  hover: {
				lineWidth: 0
			  }
		    },
		    enableMouseTracking: false
		 }{% if not forloop.last %},{% endif %}
	
	{% endfor %} 
	
	 ],
	
	{% endifequal %}
		 exporting: {
		    enabled: true
		 },
	
	   });
	   
	   
	});
	   
	
	</script>
	{% endif %}
	
{% endblock %}

{% block css %}

	<style>
		
		table.graphtable th, table.graphtable td {font-size: 10px; padding: 4px;}
		
		#contentcontainer {padding: 20px;}
		
		.activity {padding: 20px;}
		
		h1 {border-bottom: 1px solid #ccc;}
		
		a {text-decoration: none !important;}
		
		a:hover {text-decoration: underline !important;}
		
		#facebox .content
		{
			width: 800px !important;
			display: block !important;
			overflow: auto;
			height: 600px;
			padding: 40px;
			border-radius: 0 !important;
		}
		
		#facebox .close
		{
			right: 20px !important;
			top: 10px !important;
			border: 1px solid #ccc;
		}
		
		li {margin-top: 10px;}
		
		p.top {margin-bottom: 50px; border-top: 1px solid #ccc; padding-top: 5px;}
		
		p.reference {font-size: 11px;}
		
		ul.anchorlinks {margin-bottom: 50px;}
		
	</style>

{% endblock %}

{% block masthead %}
	Water Quality
{% endblock %}

{% block breadcrumbs %}
	<ul>
	<li><a href="/waterquality/introduction/" rel="facebox">Introduction</a></li>
	<li><a href="/waterquality/requiredreading/" rel="facebox">Required Reading</a></li>
	<li><a href="/waterquality/otherresources/" rel="facebox">Other Resources</a></li>
	<li><a href="{% url waterquality-browse %}" style="float: right;">Browse Data</a></li>
	</ul>
{% endblock %}

{% block content %}

<div id="contentcontainer">

	
	<!--start graphing activities -->
	<h1>Activities</h1>
	<div class="content-nav" >

	{% if section.get_previous %}
	<a href="{{section.get_previous.get_absolute_url}}" id="previous">&larr; {{section.get_previous.label}}</a>
	{% endif %}
	&nbsp;
	{% if section.get_next %}
	{% with section.get_next as next_section %}
	<a style="float: right;" href="{{section.get_next.get_absolute_url}}" id="next">{{section.get_next.label}} &rarr;</a>
	{% endwith %}
	{% endif %}

</div>
	<div id="questions" style="position: relative;">

	<form style="position: absolute; top: 50px; right: 0px;">
		<select style="width: 200px;" onchange="window.location=this.value">
		<option>Choose an Activity:</option>
		{% for module in modules %}
		<option value="{{module.get_absolute_url}}">{{module.label}}</option>
		{% endfor %}

		</select>
		</form>
		
	<div id="activitiescontainer" style="margin-right: 250px;">
		
		<div id="activity001" class="activity">
		
		<h3>{{section.label}}</h3>
		
		<form>
		<label style="display: block;">
		<input type="checkbox" checked="checked" />
		Completed
		</label>
		<label style="display: block; color: #ccc;">
		<input type="checkbox" />
		Completed
		</label>
		</form>

			<div style="overflow: auto; height: 300px; padding-right: 30px;">
			{% for block in section.pageblock_set.all %}
			{% if block.label %}<h3>{{block.label}}</h3>{% endif %}
			{% render block %}
			{% endfor %}
			</div>

		</div>
		
	</div>
	
	
</div>
	<!--stop graphing activities -->
	
	<!--start graphing tool -->
	<h1>Graphing Tool</h1>
	<form action="." method="get">
	
	{% if type %}
	
	<input type="hidden" name="type" value="{{type}}" />
	
	<div id="parameters">
	
	
	<table class="graphtable">
		<tr>
			<th style="color: #435142; width: 150px;text-align: left;">Step 1: Create Graph</th>
			<th>Graph Title:</th>
			<td><input type="text" name="title" value="{{graph_title}}"/></td>

			<th>Graph Type:</th>
			<td><input type="submit" name="type" value="time-series" /></td>
			<td><input type="submit" name="type" value="scatter-plot" /></td>
			<td><input type="submit" name="type" value="box-plot" /></td>
		</tr>
	</table>
	
	<p style="float: right;">
	<input type="submit" value="&larr; Graph This Information" style="background-color: green; color: white;" />
	</p>
	
	<table class="graphtable">
	
	<tr>
	<th style="color: #435142; width: 150px;text-align: left;">Step 2: Set Graph Parameters</th>
	<!--
	<th>
	Graph Title:
	<input type="text" name="title" value="{{graph_title}}"/>
	</th>
	-->
	
	{% ifequal type "time-series" %}
	<td>
	<b>Graph Type:</b><br />
	Time Series
	</td>
	<td>
	<b>Series:</b><br />
	<select size="4" name="series" multiple="multiple">
	{% for series in all_series %}
	<option value="{{series.id}}" {% if series.selected %}selected="selected"{% endif %}>{{series.name}} ({{series.units}})</option>
	{% endfor %}
	</select>
	</td>
	{% endifequal %}
	
	{% ifequal type "box-plot" %}
	<td>
	<b>Graph Type:</b><br />
	Box Plot
	</td>
	<td>
	<b>Series:</b><br />
	<select size="4" name="series" multiple="multiple">
	{% for series in all_series %}
	<option value="{{series.id}}" {% if series.selected %}selected="selected"{% endif %}>{{series.name}} ({{series.units}})</option>
	{% endfor %}
	</select>
	</td>
	{% endifequal %}
	
	{% ifequal type "scatter-plot" %}
	<td>
	<b>Graph Type:</b><br />
	Scatter Plot
	</td>
	<td>
	<b>Independent:</b><br />
	<select name="independent">
	{% for series in all_series %}
	<option value="{{series.id}}" {% if series.independent %}selected="selected"{% endif %}>{{series.name}} ({{series.units}})</option>
	{% endfor %}
	</select>
	<br />
	<b>Dependent:</b><br />
	<select name="dependent">
	{% for series in all_series %}
	<option value="{{series.id}}" {% if series.dependent %}selected="selected"{% endif %}>{{series.name}} ({{series.units}})</option>
	{% endfor %}
	</select><br />
	<b>Skip Zeroes:</b> 
	<input type="checkbox" name="skip_zeroes" 
		  {% if skip_zeroes %}checked="checked"{% endif %}
		  />
	</td>
	{% endifequal %}
	
	<td>
	<b>Start:</b><br />
	<input type="text" id="start" name="start" size="10" value="{{start|date:"Y-m-d"}}" />
	<br />
	<b>End:</b><br />
	<input type="text" id="end" name="end" size="10" value="{{end|date:"Y-m-d"}}" />
	</td>
	

	{% ifnotequal type "box-plot" %}

	{% for line in lines %}
	<td>
	<b>Threshold Label:</b><br />
	<input type="text" name="line_label_{{line.n}}" value="{{line.label}}" />
	<br />
	<b>Threshold Value:</b><br />
	<input type="text" name="line_value_{{line.n}}"value="{{line.value}}" />
	</td>
	{% endfor %}
	
	{% if allow_more_lines %}
	{% with lines|length as n %}
	<td>
	<b>Threshold Label:</b><br />
	<input type="text" name="line_label_{{n}}" value="" />
	<br />
	<b>Threshold Value:</b><br />
	<input type="text" name="line_value_{{n}}"value="" />
	</td>
	{% endwith %}
	{% endif %}

	{% endifnotequal %}
	
	</tr>
	
	</table>
	
	
	</div>
	
	{% if lseriesp %}
	<p>
	R<sup>2</sup>: {{lseriesp.linear_regression.rr|floatformat:2}}
	</p>
	{% endif %}
	
	{% else %}
	
	<table class="graphtable">
		<tr>
			<th style="color: #435142;width: 150px;text-align: left;">Step 1: Create Graph</th>
			<th>Enter Graph Title:</th>
			<td><input type="text" name="title" value="{{graph_title}}"/></td>

			<th>Choose Graph Type:</th>
			<td><input type="submit" name="type" value="time-series" /></td>
			<td><input type="submit" name="type" value="scatter-plot" /></td>
			<td><input type="submit" name="type" value="box-plot" /></td>
		</tr>
	</table>
	
	{% endif %}
	
	
	</form>
	{% if show_graph %}
	<div id="chart-container"></div>
	{% endif %}
	{% if show_box_plot %}
	{% with lsg.box_data as box_data %}
	{% spaceless %}
	<img src="https://chart.googleapis.com/chart?chs=600x200&cht=ls&chd=t0:-1,{% for bd in box_data.series %}{{bd.min}},{% endfor %}0|-1,{% for bd in box_data.series %}{{bd.lq}},{% endfor %}0|-1,{% for bd in box_data.series %}{{bd.uq}},{% endfor %}0|-1,{% for bd in box_data.series %}{{bd.max}},{% endfor %}0|-1,{% for bd in box_data.series %}{{bd.median}},{% endfor %}0&chm=F,0000FF,0,1:{{box_data.count}},20|H,0000FF,0,1:{{box_data.count}},1:20|H,0000FF,3,1:{{box_data.count}},1:20|H,0000FF,4,1:{{box_data.count}},1:20&chxt=y&chxr=0,{{box_data.min}},{{box_data.max}},0" width="600" height="200" />
	{% endspaceless %}
	{% endwith %}
	{% if show_ttest %}<br />
	T-Test: {{ttest|floatformat:2}}
	{% endif %}
	{% endif %}
	{% if too_much_data %}
	<p class="warning">Too many data points were selected. It would break
	  your browser, so one or more data series are not being
	  displayed. Please select fewer data series or a
	  smaller date range.</p>
	{% endif %}
	<!--stop graphing tool -->
	
</div>

{% endblock %}
