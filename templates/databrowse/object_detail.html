{% extends "base.html" %}
{% load smartif %}
{% load klass %}

{% block title %}{{ object.model.verbose_name|capfirst }}: {{ object }}{% endblock %}

{% block js %}
{{ block.super }}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="/site_media/js/mochikit/MochiKit/MochiKit.js"></script>
<script type="text/javascript" src="/site_media/js/mochikit/MochiKit/Signal.js"></script> 
<script type="text/javascript">
    function addMarker(lat, lng, map, name, type, description, id) {
        var latlng = new google.maps.LatLng(lat, lng);
        
        var marker = new google.maps.Marker({
            position: latlng, 
            map: map, 
            title: name
        });   

        var contentString = '<div style="font-size: 85%"><b>' + name + '</b><br />' +
            '<div style="color: #c6c6c6; padding-bottom: 5px;">' + type + '<br /></div>' +
            '<div style="font-size: 75%">' + description + ' ' + 
            '<a href="/portal/browse/portal/' + type + '/objects/' + id + '">More</a>' +  
            '</div></div>';

        var infowindow = new google.maps.InfoWindow({
            content: contentString
        });

        google.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map,marker);
          });
        
        return marker;
    }

    function initializeMap() {
        // Center on center of Black Rock Forest
        var latlng = new google.maps.LatLng(41.40744, -74.01457);
        var myOptions = {
                zoom: 12,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.TERRAIN
                };
        var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

        var markerCount = 0

        // Add markers for the currently viewed object.
        {% if object.instance.latitude %}
           lat = {{object.instance.latitude}};
           lng = {{object.instance.longitude}};
           if (lat && lng) {
             addMarker(lat, lng, map, "{{object.instance.name}}", "{{object.instance|klass|lower}}", "{{object.instance.description|truncatewords:20}}", {{object.instance.id}})
             markerCount++;
           }
        {% endif %}

        {% if object.instance.location %}
           {% for loc in object.instance.location.all %}
              lat = {{loc.latitude}};
              lng = {{loc.longitude}};
              if (lat && lng) {
                  addMarker(lat, lng, map, "{{loc.name}}", "location", "{{loc.descriptionz|truncatewords:20}}", {{loc.id}})
                  markerCount++;
              }
           {% endfor %}
        {% endif %}

        log('Marker Count: ' + markerCount);

        // Add markers for related objects
        {% if related_object.object_list %}
           {% for object in related_object.object_list %}
           
           {% endfor %}
        {% endif %}

        if (markerCount < 1) {
           document.getElementById("map").style.display = 'none';
        }
    }

    addLoadEvent(initializeMap);

</script>

{% endblock %}

{% block content %}

<!--div id="breadcrumbs"><a href="{{ root_url }}">Home</a> / <a href="{{ object.model.url }}">{{ object.model.verbose_name_plural|capfirst }}</a> / {{ object|escape }}</div-->


<h2>{{ object|escape }} | {{object.instance|klass}}</h2>



<table class="objectinfo" style="width: 75%">
<tr class="even"><th style="text-align: right; vertical-align: top; padding-right: 10px;">Record Type:</th><td>{{ object.model.verbose_name|capfirst }}</td></tr>
{% for field in object.fields %}
    {% if field.field.name == "id" %}
    {% else %} {% if field.field.name == "created_date" %}
    {% else %} {% if field.field.name == "modified_date" %}
    {% else %}
        <tr class="{% cycle 'odd' 'even' %}">
        <th style="width: 20%;  text-align: right; vertical-align: top; padding-right: 10px;">{{ field.field.verbose_name|capfirst }}:</th>
        <td>
        {% if field.urls %}
        {% for value, url in field.urls %}
        
            {% if field.field.name == "name" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "professional_title" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "phone" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "email" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "activation_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "collection_start_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "collection_end_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "spatial_explicit" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "rights" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "latitude" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "longitude" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "start_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "end_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "url" %}
                <a href="{{value}}">{{value|escape}}</a>
            {% else %}
                {% if url %}<a href="{{url}}">{% endif %}{{ value|escape }}{% if url %}</a>{% endif %}{% if not forloop.last %}, {% endif %}
            {% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}
        
            
        {% endfor %}
        {% else %}None{% endif %}
        </td>
        </tr>
    {% endif %} {% endif %} {% endif %}
{% endfor %}
</table>

<div id="map">
    <h2>Map</h2>
    <div id="map_canvas" style="margin: 10px; width:400px; height:400px"></div>
</div>

<h2>Related Records</h2>
    {% for related_object in object.related_objects %}
      <div class="related">
       
      {% if related_object.object_list %}
        <b>{{ related_object.object_list.0.model.model|klass }}</b> <br />
          <ul class="objectlist">
            {% for object in related_object.object_list %}
            <li class="{% cycle 'odd' 'even' %}"><a href="{{ object.url }}">{{ object|escape }}</a></li>
            {% endfor %}
          </ul>
      {% endif %}
      </div>
    {% endfor %}
    

{% endblock %}
