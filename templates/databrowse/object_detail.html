{% extends "base.html" %}
{% load smartif %}
{% load klass %}

{% block title %}{{ object.model.verbose_name|capfirst }}: {{ object }}{% endblock %}

{% block js %}
{{ block.super }}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="/site_media/js/mochikit/MochiKit/MochiKit.js"></script>
<script type="text/javascript" src="/site_media/js/mochikit/MochiKit/Signal.js"></script> 
<script type="text/javascript">
    function initializeMap() {
        var latitude, longitude;
        var description;
        var id;
        var pattern = /-?\d*\.\d*,-?\d*\.\d*/
        
        {% for field in object.fields %}
           {% if field.urls %}
              {% for value, url in field.urls %}
                 {% if field.field.name == "location" %}
                    var result=pattern.exec('{{value|escape}}');
                    if (result) {
                        coords = result[0].split(',')
                        latitude = coords[0];
                        longitude = coords[1];
                    }
                 {% else %} {% if field.field.name == "latitude" %}
                    latitude = {{value|escape}};
                 {% else %} {% if field.field.name == "longitude" %}
                    longitude = {{value|escape}};
                 {% else %} {% if field.field.name == "description" %}
                    description = "{{value|escape|truncatewords:20}}";
                 {% else %}{% if field.field.name == "id" %}
                    id = "{{value|escape}}";
                 {% endif %}{% endif %}{% endif %}{% endif %}{% endif %}
              {% endfor %}
           {% endif %}
        {% endfor %}

        log('latitude: ' + latitude + ' longitude: ' + longitude);                   

        if (latitude && longitude) {
            var latlng = new google.maps.LatLng(latitude, longitude);
            var myOptions = {
                    zoom: 8,
                    center: latlng,
                    mapTypeId: google.maps.MapTypeId.TERRAIN
                    };
            var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

            var marker = new google.maps.Marker({
                position: latlng, 
                map: map, 
                title: "{{object|escape}}"
            });   

            var contentString = '<b>{{object|escape}}</b><br />' +
                '<div style="font-size: 85%; color: #c6c6c6; padding-bottom: 5px;">' + 
                '{{object.model.verbose_name|capfirst}}<br /></div>' +
                '<div style="font-size: 75%">' + description + ' ' + 
                '<a href="/portal/browse/portal/{{object.model.verbose_name}}/objects/' + id + '">More</a>' +  
                '</div>';

            var infowindow = new google.maps.InfoWindow({
                content: contentString
            });

            google.maps.event.addListener(marker, 'click', function() {
                infowindow.open(map,marker);
              });
        }
    }

    addLoadEvent(initializeMap);

</script>

{% endblock %}

{% block content %}

<!--div id="breadcrumbs"><a href="{{ root_url }}">Home</a> / <a href="{{ object.model.url }}">{{ object.model.verbose_name_plural|capfirst }}</a> / {{ object|escape }}</div-->


<h2>{{ object|escape }} | {{object.instance|klass}}</h2>



<table class="objectinfo" style="width: 75%">
<tr class="even"><th style="text-align: right; vertical-align: top; padding-right: 10px;">Record Type:</th><td>{{ object.model.verbose_name|capfirst }}</td></tr>
{% for field in object.fields %}
    {% if field.field.name == "id" %}
    {% else %} {% if field.field.name == "created_date" %}
    {% else %} {% if field.field.name == "modified_date" %}
    {% else %}
        <tr class="{% cycle 'odd' 'even' %}">
        <th style="width: 20%;  text-align: right; vertical-align: top; padding-right: 10px;">{{ field.field.verbose_name|capfirst }}:</th>
        <td>
        {% if field.urls %}
        {% for value, url in field.urls %}
        
            {% if field.field.name == "name" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "professional_title" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "phone" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "email" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "activation_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "collection_start_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "collection_end_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "spatial_explicit" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "rights" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "latitude" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "longitude" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "start_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "end_date" %}
                {{ value|escape }}
            {% else %} {% if field.field.name == "url" %}
                <a href="{{value}}">{{value|escape}}</a>
            {% else %}
                {% if url %}<a href="{{url}}">{% endif %}{{ value|escape }}{% if url %}</a>{% endif %}{% if not forloop.last %}, {% endif %}
            {% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}
        
            
        {% endfor %}
        {% else %}None{% endif %}
        </td>
        </tr>
    {% endif %} {% endif %} {% endif %}
{% endfor %}
</table>

<h2>Map</h2>
<div id="map_canvas" style="margin: 10px; width:400px; height:400px"></div>

<h2>Related Records</h2>
    {% for related_object in object.related_objects %}
      <div class="related">
       
      {% if related_object.object_list %}
        <b>{{ related_object.object_list.0.model.model|klass }}</b> <br />
          <ul class="objectlist">
            {% for object in related_object.object_list %}
            <li class="{% cycle 'odd' 'even' %}"><a href="{{ object.url }}">{{ object|escape }}</a></li>
            {% endfor %}
          </ul>
      {% endif %}
      </div>
    {% endfor %}
    

{% endblock %}
