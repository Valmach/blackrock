{% extends "portal/base_portal.html" %}
{% load smartif %}
{% load portal %}
{% load markup %}

{% block title %}{{ object.model.verbose_name|capfirst }}: {{ object }}{% endblock %}

{% block container %}
{% with object.instance as current_object %}
{% with object.instance|klass as asset_klass %}


<div id="details-wrapper">
<table id="details-table">
<tr>
<td id="left">
    <div id="asset-details" class="blocktext">
        <h3>{{ current_object|display_name }}</h3>
        
        {% if current_object.display_image %}
            <img alt="{{asset_klass}} Icon" src="{{current_object.display_image.file.url}}" class="object_detail_image"></img>
            {% if current_object.display_image.description %}
                <div class="caption">{{current_object.display_image.description}}</div>
            {% endif %}
        {% endif %}
        
        <p><span class="object_detail_label">Record Type:</span> {{current_object|klass_display}}</p>
            
        {% if asset_klass == "DataSet" %}
            {% if current_object.description %}
                <p><p><span class="object_detail_label">Description:</span>
                {{ current_object.description|safe }}</p>
            {% endif %}
       
            {% if current_object.collection_start_date %}
                <p><span class="object_detail_label">Collection Start Date:</span>
                {{ current_object.collection_start_date|date }}</p>
            {% endif %}

            {% if current_object.collection_end_date %}
                <p><span class="object_detail_label">Collection End Date:</span>
                {{ current_object.collection_end_date|date }}</p>
            {% endif %}
        
            {% if current_object.url.all.count %}
                <p><span class="object_detail_label">Link{%if current_object.url.all.count > 0%}s{%endif%}:</span>
                <ul>
                {% for u in current_object.url.all %}
                    <li><a href="{{ u.name }}">{% if u.display_name %}{{u.display_name}}{% else %}{{u.document}}{% endif %}</a></li>
                {% endfor %}
                </ul>
            {% endif %}
        
            {% if current_object.person.all.count %}
                <p><span class="object_detail_label">People:</span>
                {% for p in current_object.person.all %}{% if forloop.counter > 1 %}, {% endif %}<a href="{{p|detail_url}}">{{p|display_name}}</a>{% endfor %}</p>
            {% endif %}
        {% else %}{% if asset_klass == "LearningActivity" %}
             
            {% if current_object.author.all.count %}
                <p><span class="object_detail_label">Authors:</span>
                {% for x in current_object.author.all %}{% if forloop.counter > 1 %}, {% endif %}<a href="{{x|detail_url}}">{{x|display_name}}</a>{% endfor %}</p>
            {% endif %}
      
            {% if current_object.description %}
                <p><span class="object_detail_label">Description:</span>
                {{ current_object.description|safe }}</p>
            {% endif %}
     
            {% if current_object.url.all.count %}
                <p><span class="object_detail_label">Link{%if current_object.url.all.count > 0%}s{%endif%}:</span>{%if current_object.url.all.count > 1%}<br />{%endif%}
                {% for u in current_object.url.all %}{% if forloop.counter > 1 %}, {% endif %}<a href="{{u.name}}">{{ u.name }}</a>{% endfor %}</p>
            {% endif %}
      
            {% if current_object.digital_format.all.count %}
                <p><span class="object_detail_label">Format:</span> 
                {% for f in current_object.digital_format.all %}{% if forloop.counter > 1 %}, {% endif %}{{ f.name }}{% endfor %}</p>
            {% endif %}
        {% else %}{% if asset_klass == "Person" %}
            {% if current_object.professional_title %}
                <p><span class="object_detail_label">Title:</span> 
                {{ current_object.professional_title }}</p>
            {% endif %}
            {% if current_object.institution.all.count %}
                <p><span class="object_detail_label">Institution:</span>
                {% for i in current_object.institution.all %}{% if forloop.counter > 1 %}, {% endif %}{{ i.name }}{% endfor %}</p>
            {% endif %}
            {% if current_object.description %}
                <p><span class="object_detail_label">Biography:</span>
                {{ current_object.description|safe }}</p>
            {% endif %}
            {% if current_object.url.all.count %}
                <p><span class="object_detail_label">Link{%if current_object.url.all.count > 0%}s{%endif%}:</span>{%if current_object.url.all.count > 1%}<br />{%endif%}
                {% for u in current_object.url.all %}{% if forloop.counter > 1 %}, {% endif %}<a href="{{ u.name }}">{{u.name}}</a>{% endfor %}</p>
            {% endif %}
            {% if current_object.person_type.all.count %}
                <p><span class="object_detail_label">Roles:</span>
                {% for t in current_object.person_type.all %}{% if forloop.counter > 1 %}, {% endif %}{{ t.name }}{% endfor %}</p>
            {% endif %}
        {% else %}{% if asset_klass == "ResearchProject" %}
            {% if current_object.start_date %}
                <p><span class="object_detail_label">Project Start Date:</span>
                {{ current_object.start_date|date }}</p>
            {% endif %} 
            {% if current_object.end_date %}
                <p><span class="object_detail_label">Project End Date:</span>
                {{ current_object.end_date|date }}</p>
            {% endif %}
            {% if current_object.person.count %} 
                <p><span class="object_detail_label">Principal Investigator{% if current_object.person.count > 1 %}s{% endif %}:</span>
                {% for p in current_object.person.all %}{% if forloop.counter > 1 %}, {% endif %}<a href="{{p|detail_url}}">{{ p|display_name }}</a>{% endfor %}</p>
            {% endif %}
            {% if current_object.description %}
                <p><span class="object_detail_label">Description:</span> 
                {{ current_object.description|safe }}</p>
            {% endif %}
       {% else %}{% if asset_klass == "Station" %}
            {% if current_object.activation_date %}
                <p><span class="object_detail_label">Activation Date:</span>
                {{ current_object.activation_date|date }}</p>
            {% endif %}
             
            {% if current_object.description %}
                <p><span class="object_detail_label">Description:</span>
                {{ current_object.description|safe }}</p>
            {% endif %}
        {% else %}{% if asset_klass == "ForestStory" %}
            {% if current_object.description %}
                <p><span class="object_detail_label">Description:</span>
                {{ current_object.description|safe }}<br />
            {% endif %}
        {% endif %}{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}
       
        {% if current_object.facet.all.count %}
            <p><span class="object_detail_label">Keyword:</span>
            {% for f in current_object.facet.all %}{% if forloop.counter > 1 %}, {% endif %}<a href="/portal/search/?q=&{{f.facet|lower}}={{f.name}}">{{ f.display_name }}</a>{% endfor %}</p>
        {% endif %}
        
   </div>
</td>
<td id="center"> 
    {% if current_object.location.latitude or current_object.latitude %}
       <div id="map-column">
          <div id="map_canvas"></div>
       </div>
    {% endif %}

    <!--  Hand-Picked "Related" Records -->
    <div id="related-items">
    {% with "mapicon_related.png" as iconname %}
    
        {% if asset_klass == "LearningActivity" %}
            {% if current_object.dataset.count %}
                <h3 class="object_detail_label">Related Data Sets:</h3>
                {% for x in current_object.dataset.all %}
                    {% with x as current_object %}
                        {% include "portal/asset_related.html" %}
                    {% endwith %}
                {% endfor %}
            {% endif %}
            {% if current_object.person.count %}
                <h3 class="object_detail_label">Related People:</h3>
                {% for x in current_object.person.all %}
                    {% with x as current_object %}
                         {% include "portal/asset_related.html" %}
                      {% endwith %}
                {% endfor %}
            {% endif %}
        {% else %}{% if asset_klass == "ResearchProject" %}
            {% if current_object.dataset.count %}
                <h3 class="object_detail_label">Related Data Sets:</h3>
                {% for x in current_object.dataset.all %}
                    {% with x as current_object %}
                        {% include "portal/asset_related.html" %}
                    {% endwith %}
                {% endfor %}
            {% endif %}
        {% else %}{% if asset_klass == "Station" %}
            {% if current_object.research_projects|length %}
                <h3 class="object_detail_label">Related Research Projects:</h3>
                {% if current_object.dataset.count %}
                    <h3 class="object_detail_label">Related Research Projects:</h3>
                    {% for x in current_object.researchproject.all %}
                        {% with x as current_object %}
                            {% include "portal/asset_related.html" %}
                        {% endwith %}
                    {% endfor %}
                {% endif %}
            {% endif %}
            {% if current_object.dataset.count %}
                <h3 class="object_detail_label">Related Data Sets:</h3>
                {% for x in current_object.dataset.all %}
                    {% with x as current_object %}
                        {% include "portal/asset_related.html" %}
                    {% endwith %}
                {% endfor %}
            {% endif %}  
        {% endif %}{% endif %}{% endif %}
        
        <!--  Related Database Records -->
        {% for related_object in object.related_objects %}
            {% if related_object.object_list %}
                {% for object in related_object.object_list %}
                        {% ifequal forloop.counter 1 %}
                            <h3 class="object_detail_label">Related {{object.instance|klass_display_plural}}</h3>
                        {% endifequal %}
                    
                        {% with object.instance as current_object %}		   
    	                   {% include "portal/asset_related.html" %}
                        {% endwith %}
                    
                {% endfor %}
            {% endif %}
        {% endfor %}
   {% endwith %}    
   </div></td><!-- end related section --></tr></table>

{% with "geocode" as geocode_class %}
   {% include "portal/asset_location.html" %}
{% endwith %}
   
<p class="clear"></p>
</div> <!-- end detail-page -->
    
{% endwith %}{% endwith %}
{% endblock %}
